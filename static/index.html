<!DOCTYPE html>
<html>
  <head>
    <link href="style.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div id="header-container">
      <h1>Super-Todo</h1>
      <div class="box"></div>
    </div>
    <ul class="todoList"></ul>
    <form name="myform" action="javascript:addToDo()">
      <input id="textfield" name="Text" type="text" placeholder="Add a todo">
      <input name="Submit"  type="submit" value="Update"/>
    </form>
	<script src="jquery-1.9.0.js"></script>
	<script>

  var todoList;

  function addToDo() {
    var textfield = $("#textfield");
    add(textfield.val());
    textfield.val("");
  }
  
  function refreshDOM() {
    if (todoList === undefined) return;
    var container = $(".todoList");
    container.html("");
    for (var i = 0; i < todoList.length; i++) {
      var todo = todoList[i];
      var li = $("<li>");
      var checkbox = $('<input type="checkbox">').attr("id", i).addClass("checkbox");
      if (todo.completed) {
        li.addClass("completed");
        checkbox.attr("checked", "checked");
      } else {
        checkbox.removeAttr("checked");
      }
      var desc = $("<span>").html(todoList[i].desc);
      li.append(checkbox);
      li.append(desc);
      container.append(li);
    }

    $(".checkbox").click(function() {
      var element = $(this);
      var id = element.attr("id");
      var isChecked = element.attr("checked");
      element.removeAttr("checked");
      edit(id, todoList[id].desc, !isChecked);
    });
  }
  
	function get() {
		$.ajax({
			type: "get",
			url: "/todo",
			success: function(data) {
        todoList = data.todoList;
        refreshDOM();
			}
		});
	}

	function add(desc) {
		$.ajax({
			type: "post",
			data: {desc: desc},
			url: "/todo",
			success: function(data) {
        todoList = data.todoList;
        refreshDOM();
			}
		});
	}

	function edit(id, desc, completed) {
		$.ajax({
			type: "put",
			data: {desc: desc, completed: completed},
			url: "/todo/" + id,
			success: function(data) {
        todoList = data.todoList;
        refreshDOM();
			}
		});
	}

	function del(id) {
		$.ajax({
			type: "delete",
			url: "/todo/" + id,
			success: function(data) {
        todoList = data.todoList;
        refreshDOM();
			}
		});
	}

	function delAll() {
		$.ajax({
			type: "delete",
			url: "/todo",
			success: function(data) {
        todoList = data.todoList;
        refreshDOM();
			}
		});
	}

  $(document).ready(function() {
    get();
  });
	</script>
	</body>
</html>
